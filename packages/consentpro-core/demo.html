<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ConsentPro Demo - Cookie Consent Banner</title>
    <link rel="stylesheet" href="dist/consentpro.min.css" />
    <style>
      :root {
        --demo-primary: #2563eb;
        --demo-text: #1e293b;
        --demo-muted: #64748b;
        --demo-border: #e2e8f0;
        --demo-bg: #f8fafc;
        --demo-card: #ffffff;
        --demo-success: #10b981;
        --demo-warning: #f59e0b;
        --demo-danger: #ef4444;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
        margin: 0;
        padding: 0;
        background: var(--demo-bg);
        color: var(--demo-text);
        line-height: 1.6;
      }

      .demo-header {
        background: var(--demo-card);
        border-bottom: 1px solid var(--demo-border);
        padding: 1.5rem 2rem;
      }

      .demo-header__inner {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .demo-logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        text-decoration: none;
        color: var(--demo-text);
      }

      .demo-logo__icon {
        width: 40px;
        height: 40px;
        background: var(--demo-primary);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .demo-logo__icon svg {
        width: 24px;
        height: 24px;
        color: white;
      }

      .demo-logo__text {
        font-weight: 700;
        font-size: 1.25rem;
      }

      .demo-logo__badge {
        background: var(--demo-primary);
        color: white;
        font-size: 0.625rem;
        font-weight: 600;
        padding: 0.125rem 0.375rem;
        border-radius: 4px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .demo-header__meta {
        display: flex;
        align-items: center;
        gap: 1rem;
        font-size: 0.875rem;
        color: var(--demo-muted);
      }

      .demo-header__meta strong {
        color: var(--demo-text);
      }

      .demo-main {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
        display: grid;
        grid-template-columns: 1fr 340px;
        gap: 2rem;
      }

      @media (max-width: 900px) {
        .demo-main {
          grid-template-columns: 1fr;
        }
      }

      .demo-content {
        display: flex;
        flex-direction: column;
        gap: 2rem;
      }

      .demo-card {
        background: var(--demo-card);
        border: 1px solid var(--demo-border);
        border-radius: 12px;
        padding: 1.5rem;
      }

      .demo-card__title {
        font-size: 1rem;
        font-weight: 600;
        margin: 0 0 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .demo-card__title svg {
        width: 20px;
        height: 20px;
        color: var(--demo-primary);
      }

      .demo-intro {
        font-size: 0.9375rem;
        color: var(--demo-muted);
        margin: 0;
      }

      .demo-features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
      }

      .demo-feature {
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
        padding: 0.75rem;
        background: var(--demo-bg);
        border-radius: 8px;
      }

      .demo-feature__icon {
        width: 32px;
        height: 32px;
        background: var(--demo-primary);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .demo-feature__icon svg {
        width: 18px;
        height: 18px;
        color: white;
      }

      .demo-feature__text {
        font-size: 0.8125rem;
        font-weight: 500;
      }

      .demo-feature__desc {
        font-size: 0.75rem;
        color: var(--demo-muted);
        margin-top: 0.125rem;
      }

      /* Consent Status Panel */
      .demo-status {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .demo-status__indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        border-radius: 8px;
        font-weight: 500;
        font-size: 0.875rem;
      }

      .demo-status__indicator--none {
        background: #fef3c7;
        color: #92400e;
      }

      .demo-status__indicator--full {
        background: #d1fae5;
        color: #065f46;
      }

      .demo-status__indicator--partial {
        background: #dbeafe;
        color: #1e40af;
      }

      .demo-status__dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        animation: pulse 2s infinite;
      }

      .demo-status__indicator--none .demo-status__dot {
        background: #f59e0b;
      }
      .demo-status__indicator--full .demo-status__dot {
        background: #10b981;
      }
      .demo-status__indicator--partial .demo-status__dot {
        background: #3b82f6;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .demo-categories {
        display: grid;
        gap: 0.5rem;
      }

      .demo-category {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.625rem 0.75rem;
        background: var(--demo-bg);
        border-radius: 6px;
        font-size: 0.8125rem;
      }

      .demo-category__status {
        display: flex;
        align-items: center;
        gap: 0.375rem;
        font-weight: 500;
      }

      .demo-category__status--true {
        color: var(--demo-success);
      }
      .demo-category__status--false {
        color: var(--demo-muted);
      }

      .demo-actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      .demo-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.5rem 1rem;
        font-size: 0.8125rem;
        font-weight: 500;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.15s ease;
      }

      .demo-btn svg {
        width: 16px;
        height: 16px;
      }

      .demo-btn--primary {
        background: var(--demo-primary);
        color: white;
      }

      .demo-btn--primary:hover {
        background: #1d4ed8;
      }

      .demo-btn--danger {
        background: #fee2e2;
        color: #dc2626;
      }

      .demo-btn--danger:hover {
        background: #fecaca;
      }

      .demo-btn--secondary {
        background: var(--demo-bg);
        color: var(--demo-text);
        border: 1px solid var(--demo-border);
      }

      .demo-btn--secondary:hover {
        background: var(--demo-border);
      }

      /* Script Blocking Demo */
      .demo-scripts {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .demo-script {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem;
        background: var(--demo-bg);
        border-radius: 8px;
        font-size: 0.8125rem;
      }

      .demo-script__icon {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .demo-script__icon--blocked {
        background: #fee2e2;
        color: #dc2626;
      }

      .demo-script__icon--allowed {
        background: #d1fae5;
        color: #059669;
      }

      .demo-script__icon svg {
        width: 16px;
        height: 16px;
      }

      .demo-script__info {
        flex: 1;
        min-width: 0;
      }

      .demo-script__name {
        font-weight: 500;
        margin-bottom: 0.125rem;
      }

      .demo-script__category {
        font-size: 0.75rem;
        color: var(--demo-muted);
      }

      .demo-script__status {
        font-size: 0.6875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
      }

      .demo-script__status--blocked {
        background: #fee2e2;
        color: #dc2626;
      }

      .demo-script__status--allowed {
        background: #d1fae5;
        color: #059669;
      }

      /* Performance Panel */
      .demo-perf {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem 1rem;
        background: var(--demo-bg);
        border-radius: 8px;
      }

      .demo-perf__value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--demo-primary);
      }

      .demo-perf__label {
        font-size: 0.75rem;
        color: var(--demo-muted);
      }

      .demo-perf__status {
        font-size: 0.75rem;
        font-weight: 500;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
      }

      .demo-perf__status--pass {
        background: #d1fae5;
        color: #059669;
      }

      .demo-perf__status--fail {
        background: #fee2e2;
        color: #dc2626;
      }

      /* Sidebar */
      .demo-sidebar {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      /* Raw JSON Panel */
      .demo-json {
        background: #1e293b;
        color: #e2e8f0;
        border-radius: 8px;
        padding: 1rem;
        font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
        font-size: 0.6875rem;
        line-height: 1.5;
        overflow-x: auto;
        max-height: 200px;
        overflow-y: auto;
      }

      .demo-json::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }

      .demo-json::-webkit-scrollbar-thumb {
        background: #475569;
        border-radius: 3px;
      }

      /* Footer */
      .demo-footer {
        margin-top: 2rem;
        padding: 1.5rem 2rem;
        background: var(--demo-card);
        border-top: 1px solid var(--demo-border);
        text-align: center;
        font-size: 0.8125rem;
        color: var(--demo-muted);
      }

      .demo-footer a {
        color: var(--demo-primary);
        text-decoration: none;
      }

      .demo-footer a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="demo-header">
      <div class="demo-header__inner">
        <a href="#" class="demo-logo">
          <div class="demo-logo__icon">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
            </svg>
          </div>
          <span class="demo-logo__text">ConsentPro</span>
          <span class="demo-logo__badge">v1.0</span>
        </a>
        <div class="demo-header__meta">
          <span>Bundle: <strong id="bundle-size">4.66 KB</strong> gzipped</span>
          <span>|</span>
          <span>Init: <strong id="init-time-header">--</strong></span>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="demo-main">
      <div class="demo-content">
        <!-- Introduction -->
        <section class="demo-card">
          <h2 class="demo-card__title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <path d="M12 16v-4M12 8h.01" />
            </svg>
            Interactive Demo
          </h2>
          <p class="demo-intro">
            This is a fully functional ConsentPro consent banner. Try the different consent flows:
            Accept All, Reject Non-Essential, or customize via Cookie Settings. Consent persists in
            localStorage with cookie fallback for Safari ITP.
          </p>
          <div class="demo-features">
            <div class="demo-feature">
              <div class="demo-feature__icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                  <path d="M7 11V7a5 5 0 0110 0v4" />
                </svg>
              </div>
              <div>
                <div class="demo-feature__text">GDPR/CCPA Ready</div>
                <div class="demo-feature__desc">Geo-targeted compliance</div>
              </div>
            </div>
            <div class="demo-feature">
              <div class="demo-feature__icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                </svg>
              </div>
              <div>
                <div class="demo-feature__text">Two-Layer UI</div>
                <div class="demo-feature__desc">Quick actions + detailed settings</div>
              </div>
            </div>
            <div class="demo-feature">
              <div class="demo-feature__icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="3" />
                  <path
                    d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"
                  />
                </svg>
              </div>
              <div>
                <div class="demo-feature__text">Category Control</div>
                <div class="demo-feature__desc">
                  Essential, Analytics, Marketing, Personalization
                </div>
              </div>
            </div>
            <div class="demo-feature">
              <div class="demo-feature__icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                  <circle cx="12" cy="12" r="3" />
                </svg>
              </div>
              <div>
                <div class="demo-feature__text">WCAG 2.1 AA</div>
                <div class="demo-feature__desc">Keyboard nav, screen readers</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Script Blocking Demo -->
        <section class="demo-card">
          <h2 class="demo-card__title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />
            </svg>
            Script Blocking Status
          </h2>
          <p class="demo-intro" style="margin-bottom: 1rem">
            Scripts are blocked until the matching category is consented. Essential scripts always
            run.
          </p>
          <div class="demo-scripts" id="script-status">
            <!-- Populated by JS -->
          </div>
        </section>

        <!-- Test Actions -->
        <section class="demo-card">
          <h2 class="demo-card__title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path
                d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"
              />
            </svg>
            Test Actions
          </h2>
          <div class="demo-actions">
            <button type="button" class="demo-btn demo-btn--danger" id="clear-consent">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6" />
                <path
                  d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"
                />
              </svg>
              Clear Consent
            </button>
            <button type="button" class="demo-btn demo-btn--primary" id="show-banner">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                <circle cx="12" cy="12" r="3" />
              </svg>
              Show Banner
            </button>
            <button type="button" class="demo-btn demo-btn--secondary" id="reload-page">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 4v6h-6M1 20v-6h6" />
                <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15" />
              </svg>
              Reload Page
            </button>
          </div>
        </section>
      </div>

      <!-- Sidebar -->
      <aside class="demo-sidebar">
        <!-- Consent Status -->
        <section class="demo-card">
          <h2 class="demo-card__title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
            </svg>
            Consent Status
          </h2>
          <div class="demo-status">
            <div class="demo-status__indicator demo-status__indicator--none" id="status-indicator">
              <span class="demo-status__dot"></span>
              <span id="status-text">No consent given</span>
            </div>
            <div class="demo-categories" id="category-status">
              <!-- Populated by JS -->
            </div>
          </div>
        </section>

        <!-- Performance -->
        <section class="demo-card">
          <h2 class="demo-card__title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />
            </svg>
            Performance
          </h2>
          <div class="demo-perf">
            <div>
              <div class="demo-perf__value" id="init-time-value">--</div>
              <div class="demo-perf__label">Init time (ms)</div>
            </div>
            <span class="demo-perf__status demo-perf__status--pass" id="perf-status"
              >Target: &lt;50ms</span
            >
          </div>
        </section>

        <!-- Raw Data -->
        <section class="demo-card">
          <h2 class="demo-card__title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="16 18 22 12 16 6" />
              <polyline points="8 6 2 12 8 18" />
            </svg>
            Raw Consent Data
          </h2>
          <pre class="demo-json" id="consent-json">null</pre>
        </section>
      </aside>
    </main>

    <!-- Footer -->
    <footer class="demo-footer">
      ConsentPro v1.0.0 &middot;
      <a href="https://github.com/pxdsgnco/consentpro" target="_blank">GitHub</a> &middot; Iteration
      1 Shippable Demo &middot; <5KB gzipped
    </footer>

    <!-- Banner container -->
    <aside id="consentpro-banner" class="consentpro"></aside>

    <!-- Example blocked scripts (for demonstration) -->
    <script type="text/plain" data-consentpro="analytics" data-script-name="Google Analytics">
      console.log('[Demo] Google Analytics script executed!');
      window.__analyticsLoaded = true;
    </script>
    <script type="text/plain" data-consentpro="marketing" data-script-name="Facebook Pixel">
      console.log('[Demo] Facebook Pixel script executed!');
      window.__marketingLoaded = true;
    </script>
    <script
      type="text/plain"
      data-consentpro="personalization"
      data-script-name="Personalization Engine"
    >
      console.log('[Demo] Personalization Engine script executed!');
      window.__personalizationLoaded = true;
    </script>

    <script src="dist/consentpro.min.js"></script>
    <script>
      // Performance measurement for US-011 (<50ms requirement)
      const initStartTime = performance.now();

      // Demo configuration
      const defaultConfig = {
        geo: null,
        geoEnabled: true,
        policyUrl: 'https://example.com/privacy',
        categories: [
          {
            id: 'essential',
            name: 'Essential',
            description: 'Required for site functionality',
            required: true,
          },
          {
            id: 'analytics',
            name: 'Analytics',
            description: 'Help us understand usage',
            required: false,
          },
          {
            id: 'marketing',
            name: 'Marketing',
            description: 'Personalized advertisements',
            required: false,
          },
          {
            id: 'personalization',
            name: 'Personalization',
            description: 'Remember your preferences',
            required: false,
          },
        ],
        text: {
          heading: 'We value your privacy',
          description: 'We use cookies to enhance your experience.',
          acceptAll: 'Accept All',
          rejectNonEssential: 'Reject Non-Essential',
          settings: 'Cookie Settings',
          save: 'Save Preferences',
          back: 'Back',
          settingsTitle: 'Privacy Preferences',
          footerToggle: 'Privacy Settings',
        },
        colors: {
          primary: '#2563eb',
          secondary: '#64748b',
          background: '#ffffff',
          text: '#1e293b',
        },
      };

      // Initialize ConsentPro
      const storage = new ConsentPro.StorageAdapter();
      const manager = new ConsentPro.ConsentManager(storage);
      const banner = new ConsentPro.BannerUI(manager);
      const scriptBlocker = new ConsentPro.ScriptBlocker();

      // Expose globally for Cypress access and debugging
      window.consentProBanner = banner;
      window.consentProManager = manager;
      window.consentProStorage = storage;
      window.consentProScriptBlocker = scriptBlocker;

      // Initialize with config
      banner.init('consentpro-banner', defaultConfig);
      banner.renderFooterToggle();

      // Initialize ScriptBlocker with current consent (US-012a/b)
      const existingConsent = manager.getConsent();
      if (existingConsent) {
        scriptBlocker.init(existingConsent.categories);
      } else {
        // Initialize with essential-only consent for essential scripts
        scriptBlocker.init({
          essential: true,
          analytics: false,
          marketing: false,
          personalization: false,
        });
      }

      // Show banner if no existing consent (US-011: consent persistence check)
      if (!manager.isConsentValid()) {
        banner.show();
      }

      // Performance measurement complete
      const initEndTime = performance.now();
      const initDuration = initEndTime - initStartTime;
      const initMs = initDuration.toFixed(2);

      console.log(`[ConsentPro] Init time: ${initMs}ms (target: <50ms)`);
      if (initDuration > 50) {
        console.warn('[ConsentPro] Init time exceeded 50ms target!');
      }

      // Update init time display
      document.getElementById('init-time-header').textContent = `${initMs}ms`;
      document.getElementById('init-time-value').textContent = initMs;

      const perfStatus = document.getElementById('perf-status');
      if (initDuration <= 50) {
        perfStatus.textContent = 'PASS (<50ms)';
        perfStatus.className = 'demo-perf__status demo-perf__status--pass';
      } else {
        perfStatus.textContent = 'FAIL (>50ms)';
        perfStatus.className = 'demo-perf__status demo-perf__status--fail';
      }

      // Update UI function
      function updateUI() {
        const consent = manager.getConsent();
        const categories = ['essential', 'analytics', 'marketing', 'personalization'];

        // Update status indicator
        const indicator = document.getElementById('status-indicator');
        const statusText = document.getElementById('status-text');

        if (!consent) {
          indicator.className = 'demo-status__indicator demo-status__indicator--none';
          statusText.textContent = 'No consent given';
        } else {
          const allTrue = categories.every((c) => consent.categories[c]);
          const onlyEssential =
            consent.categories.essential &&
            !consent.categories.analytics &&
            !consent.categories.marketing &&
            !consent.categories.personalization;

          if (allTrue) {
            indicator.className = 'demo-status__indicator demo-status__indicator--full';
            statusText.textContent = 'Full consent (all categories)';
          } else if (onlyEssential) {
            indicator.className = 'demo-status__indicator demo-status__indicator--partial';
            statusText.textContent = 'Essential only';
          } else {
            indicator.className = 'demo-status__indicator demo-status__indicator--partial';
            statusText.textContent = 'Custom consent';
          }
        }

        // Update category status
        const categoryHtml = categories
          .map((cat) => {
            const isConsented = consent?.categories[cat] ?? cat === 'essential';
            const icon = isConsented
              ? '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M20 6L9 17l-5-5"/></svg>'
              : '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M18 6L6 18M6 6l12 12"/></svg>';
            return `
          <div class="demo-category">
            <span>${cat.charAt(0).toUpperCase() + cat.slice(1)}</span>
            <span class="demo-category__status demo-category__status--${isConsented}">${icon} ${isConsented ? 'Allowed' : 'Blocked'}</span>
          </div>
        `;
          })
          .join('');
        document.getElementById('category-status').innerHTML = categoryHtml;

        // Update script status
        const scripts = [
          { name: 'Google Analytics', category: 'analytics', icon: 'GA' },
          { name: 'Facebook Pixel', category: 'marketing', icon: 'FB' },
          { name: 'Personalization Engine', category: 'personalization', icon: 'PE' },
        ];

        const scriptHtml = scripts
          .map((script) => {
            const isAllowed = consent?.categories[script.category] ?? false;
            return `
          <div class="demo-script">
            <div class="demo-script__icon demo-script__icon--${isAllowed ? 'allowed' : 'blocked'}">
              ${
                isAllowed
                  ? '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>'
                  : '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>'
              }
            </div>
            <div class="demo-script__info">
              <div class="demo-script__name">${script.name}</div>
              <div class="demo-script__category">${script.category} category</div>
            </div>
            <span class="demo-script__status demo-script__status--${isAllowed ? 'allowed' : 'blocked'}">
              ${isAllowed ? 'Allowed' : 'Blocked'}
            </span>
          </div>
        `;
          })
          .join('');
        document.getElementById('script-status').innerHTML = scriptHtml;

        // Update raw JSON
        document.getElementById('consent-json').textContent = consent
          ? JSON.stringify(consent, null, 2)
          : 'null';

        // Note: Script unblocking is handled automatically by ScriptBlocker
        // via its consentpro_consent event listener (US-012a/b)
      }

      // Initial UI update
      updateUI();

      // Listen for consent changes
      document.addEventListener('consentpro_consent', updateUI);
      document.addEventListener('consentpro_ready', updateUI);

      // Test action buttons
      document.getElementById('clear-consent').addEventListener('click', () => {
        manager.clearConsent();
        updateUI();
        banner.show();
      });

      document.getElementById('show-banner').addEventListener('click', () => {
        banner.show();
      });

      document.getElementById('reload-page').addEventListener('click', () => {
        location.reload();
      });
    </script>
  </body>
</html>
